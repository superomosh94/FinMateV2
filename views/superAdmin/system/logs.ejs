<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar would be here -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">System Logs</h1>
                </div>

                <% if (success) { %>
                    <div class="alert alert-success"><%= success %></div>
                <% } %>
                <% if (error) { %>
                    <div class="alert alert-danger"><%= error %></div>
                <% } %>

                <!-- Filters -->
                <div class="card mb-4">
                    <div class="card-body">
                        <form method="GET" class="row g-3">
                            <div class="col-md-3">
                                <label class="form-label">Level</label>
                                <select name="level" class="form-select">
                                    <option value="">All Levels</option>
                                    <option value="info" <%= filters.level === 'info' ? 'selected' : '' %>>Info</option>
                                    <option value="warning" <%= filters.level === 'warning' ? 'selected' : '' %>>Warning</option>
                                    <option value="error" <%= filters.level === 'error' ? 'selected' : '' %>>Error</option>
                                    <option value="debug" <%= filters.level === 'debug' ? 'selected' : '' %>>Debug</option>
                                </select>
                            </div>
                            <div class="col-md-5">
                                <label class="form-label">Search</label>
                                <input type="text" name="search" class="form-control" placeholder="Search messages..." value="<%= filters.search %>">
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <button type="submit" class="btn btn-primary me-2">Filter</button>
                                <a href="/super-admin/system-logs" class="btn btn-secondary">Clear</a>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">System Logs</h5>
                        <form method="POST" action="/super-admin/system-logs/clear" class="d-inline">
                            <button type="submit" class="btn btn-warning btn-sm" onclick="return confirm('Are you sure you want to clear system logs?')">
                                <i class="fas fa-trash"></i> Clear Logs
                            </button>
                        </form>
                    </div>
                    <div class="card-body">
                        <% if (systemLogs.length > 0) { %>
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Level</th>
                                            <th>Message</th>
                                            <th>Context</th>
                                            <th>Created</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% systemLogs.forEach(log => { %>
                                            <tr>
                                                <td><%= log.id %></td>
                                                <td>
                                                    <span class="badge bg-<%= 
                                                        log.level === 'error' ? 'danger' : 
                                                        log.level === 'warning' ? 'warning' : 
                                                        log.level === 'info' ? 'info' : 'secondary' 
                                                    %>">
                                                        <%= log.level %>
                                                    </span>
                                                </td>
                                                <td><%= log.message %></td>
                                                <td><%= log.context || '-' %></td>
                                                <td><%= new Date(log.created_at).toLocaleString() %></td>
                                            </tr>
                                        <% }) %>
                                    </tbody>
                                </table>
                            </div>
                        <% } else { %>
                            <p class="text-muted">No system logs found.</p>
                        <% } %>
                    </div>
                </div>

                <!-- Pagination -->
                <% if (pagination.totalPages > 1) { %>
                    <nav aria-label="Page navigation" class="mt-3">
                        <ul class="pagination justify-content-center">
                            <% if (pagination.hasPrev) { %>
                                <li class="page-item">
                                    <a class="page-link" href="?page=<%= pagination.page - 1 %>&limit=<%= pagination.limit %>&level=<%= filters.level %>&search=<%= filters.search %>">Previous</a>
                                </li>
                            <% } %>
                            
                            <% for (let i = 1; i <= pagination.totalPages; i++) { %>
                                <li class="page-item <%= i === pagination.page ? 'active' : '' %>">
                                    <a class="page-link" href="?page=<%= i %>&limit=<%= pagination.limit %>&level=<%= filters.level %>&search=<%= filters.search %>"><%= i %></a>
                                </li>
                            <% } %>
                            
                            <% if (pagination.hasNext) { %>
                                <li class="page-item">
                                    <a class="page-link" href="?page=<%= pagination.page + 1 %>&limit=<%= pagination.limit %>&level=<%= filters.level %>&search=<%= filters.search %>">Next</a>
                                </li>
                            <% } %>
                        </ul>
                    </nav>
                <% } %>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>